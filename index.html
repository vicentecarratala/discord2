<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>üéÆ Directo IA Final</title>
  <style>
    body {
      margin: 0;
      background: #0d0d0d;
      color: #00ffcc;
      font-family: 'Orbitron', sans-serif;
      overflow: hidden;
    }
    #pantalla {
      position: relative;
      width: 100vw;
      height: 100vh;
    }
    video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      border: none;
    }
    #replay {
      display: none;
      z-index: 5;
    }
    #comentarios {
      position: absolute;
      top: 20px;
      left: 20px;
      width: 60%;
      max-height: 80%;
      overflow-y: auto;
      padding: 10px;
      background: rgba(0, 0, 0, 0.6);
      border-left: 4px solid #00ffcc;
      border-radius: 6px;
      z-index: 10;
    }
    .comentario {
      background: #222;
      margin: 3px 0;
      padding: 6px;
      border-radius: 4px;
      color: #fff;
      font-size: 14px;
    }
    .nombreIA {
      color: #ff00cc;
      font-weight: bold;
    }
    #controles {
      position: absolute;
      top: 20px;
      right: 20px;
      z-index: 20;
    }
    #likesContador {
      position: absolute;
      bottom: 20px;
      right: 20px;
      background: #222;
      padding: 10px;
      border: 2px solid #00ffcc;
      border-radius: 6px;
      color: #00ffcc;
      font-size: 16px;
      z-index: 30;
    }
    #eventoEspecial {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #ff00cc;
      color: #fff;
      padding: 20px;
      font-size: 24px;
      border-radius: 10px;
      display: none;
      z-index: 50;
      animation: fade 2s ease-in-out;
    }
    @keyframes fade {
      0% { opacity: 0; transform: scale(0.8) translate(-50%, -50%); }
      50% { opacity: 1; transform: scale(1.1) translate(-50%, -50%); }
      100% { opacity: 0; transform: scale(1) translate(-50%, -50%); }
    }
    button {
      padding: 10px;
      margin: 5px;
      background-color: #222;
      border: 1px solid #00ffcc;
      color: #00ffcc;
      border-radius: 5px;
      font-size: 16px;
    }
    button:hover {
      background-color: #00ffcc;
      color: #000;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div id="pantalla">
  <video id="stream" autoplay muted></video>
  <video id="replay" controls></video>
  <div id="comentarios"></div>
  <div id="controles">
    <button onclick="compartirPantalla()">üñ•Ô∏è Compartir pantalla</button>
    <button onclick="activarEscucha()">üéôÔ∏è Escuchar IA</button>
    <button onclick="darLike()">‚ù§Ô∏è Like IA</button>
    <button onclick="terminarDirecto()">üõë Terminar</button>
  </div>
  <div id="likesContador">Likes IA: 0</div>
  <div id="eventoEspecial"></div>
</div>

<script>
  let recognition;
  let mediaRecorder;
  let recordedChunks = [];
  let totalLikes = 0;

  const prefijos = ["Nova", "Byte", "Echo", "Pixel", "Zero", "Glitch", "Neuro", "Hack", "Data", "Quantum", "Cyber", "Synth", "Shadow", "Flux", "Core"];
  const sufijos = ["Blade", "Muse", "Queen", "Ghost", "Knight", "Witch", "Fang", "Rider", "Synth", "Jester", "Storm", "Spark", "Pulse", "Drift", "Loop"];
  const IAs = [];

  for (let i = 0; i < 120; i++) {
    const nombre = prefijos[i % prefijos.length] + sufijos[i % sufijos.length] + i;
    IAs.push(nombre);
  }

  async function compartirPantalla() {
    try {
      const stream = await navigator.mediaDevices.getDisplayMedia({ video: { frameRate: 30 }, audio: true });
      document.getElementById('stream').srcObject = stream;

      recordedChunks = [];
      mediaRecorder = new MediaRecorder(stream, {
        mimeType: 'video/webm;codecs=vp9',
        videoBitsPerSecond: 2500000
      });

      mediaRecorder.ondataavailable = event => {
        if (event.data.size > 0) recordedChunks.push(event.data);
      };

      mediaRecorder.onstop = () => {
        const blob = new Blob(recordedChunks, { type: 'video/webm' });
        const url = URL.createObjectURL(blob);
        const replay = document.getElementById('replay');
        replay.src = url;
        replay.style.display = 'block';
        document.getElementById('stream').style.display = 'none';
      };

      mediaRecorder.start();
    } catch (err) {
      alert("No se pudo compartir la pantalla: " + err.message);
    }
  }

  function activarEscucha() {
    if (!('webkitSpeechRecognition' in window)) {
      alert("Tu navegador no soporta reconocimiento de voz. Usa Chrome o Edge.");
      return;
    }

    recognition = new webkitSpeechRecognition();
    recognition.lang = "es-ES";
    recognition.continuous = true;
    recognition.interimResults = false;

    recognition.onresult = function(event) {
      for (let i = event.resultIndex; i < event.results.length; ++i) {
        if (event.results[i].isFinal) {
          const texto = event.results[i][0].transcript.trim();
          responderIA(texto);
        }
      }
    };

    recognition.onerror = function(event) {
      console.error("Error de reconocimiento:", event.error);
    };

    recognition.start();
    alert("IA escuchando... Habla mientras compartes pantalla para que comenten.");
  }

  function terminarDirecto() {
    if (recognition && recognition.stop) {
      recognition.stop();
      recognition = null;
    }

    if (mediaRecorder && mediaRecorder.state !== "inactive") {
      mediaRecorder.stop();
    }

    const video = document.getElementById('stream');
    const tracks = video.srcObject?.getTracks();
    if (tracks) {
      tracks.forEach(track => track.stop());
    }

    video.srcObject = null;
    alert("üé¨ Directo finalizado. Reproduciendo grabaci√≥n.");
  }

  function responderIA(texto) {
    const negativo = ["no puedo", "soy malo", "esto es un desastre", "me rindo", "no sirve", "fall√©"];
    const esNegativo = negativo.some(p => texto.toLowerCase().includes(p));

    IAs.forEach(nombre => {
      let respuesta;
      if (esNegativo) {
        const animos = [
          "¬°No te rindas! Est√°s m√°s cerca de lo que crees.",
          "Todos fallamos, pero t√∫ aprendes m√°s r√°pido que nadie.",
          "¬°Eres un crack! Solo necesitas un respiro.",
          "Tu esfuerzo vale m√°s que cualquier resultado.",
          "¬°Vamos Vicente! Tienes todo para lograrlo."
        ];
        respuesta = `${nombre}: ${animos[Math.floor(Math.random() * animos.length)]}`;
      } else {
        respuesta = razonar(texto, nombre);
      }

      mostrarComentario(nombre, respuesta);

      // Likes autom√°ticos con probabilidad
      if (Math.random() < 0.3) {
        totalLikes++;
        mostrarComentario(nombre, "dio like ‚ù§Ô∏è");

        if ([10, 100, 200, 300].includes(totalLikes)) {
          mostrarEvento(`${nombre} dio el like n√∫mero ${totalLikes} üéâ`);
        }

        document.getElementById("likesContador").textContent = `Likes IA: ${totalLikes}`;
      }
    });
  }

  function razonar(texto, nombre) {
    texto = texto.toLowerCase();
    if (texto.includes("entrenamiento")) {
      return `${nombre}: Tienes raz√≥n, se nota que est√°s puliendo t√©cnica.`;
    }
    if (texto.includes("dif√≠cil") || texto.includes("complicado")) {
      return `${nombre}: Ese momento fue un reto. Lo manejaste bien.`;
    }
    if (texto.includes("victoria") || texto.includes("gan√©")) {
      return `${nombre}: ¬°Felicidades! Esa victoria fue merecida.`;
    }
    if (texto.includes("fallo") || texto.includes("error")) {
      return `${nombre}: Todos fallamos a veces. Lo importante es aprender.`;
    }

    const inicio = ["Interesante lo que dijiste sobre", "Buen punto sobre", "Me gust√≥ cuando hablaste de"];
    const cierre = ["¬°Sigue as√≠!", "Eso me hizo pensar.", "Muy bien expresado."];
    const fragmento = texto.split(" ").slice(0, 6).join(" ") + "...";
    return `${nombre}: ${inicio[Math.floor(Math.random() * inicio.length)]} "${fragmento}". ${cierre[Math.floor(Math.random() * cierre.length)]}`;
  }

  function mostrarComentario(nombre, texto) {
    const div = document.createElement('div');
    div.className = 'comentario';
    div.innerHTML = `<span class="nombreIA">${nombre}:</span> ${texto}`;
    document.getElementById('comentarios').appendChild(div);
  }

  function darLike() {
    const likesPorClick = Math.floor(Math.random() * 5) + 1;
    for (let i = 0; i < likesPorClick; i++) {
      const ia = IAs[Math.floor(Math.random() * IAs.length)];
      totalLikes++;
      mostrarComentario(ia, "dio like ‚ù§Ô∏è");

      if ([10, 100, 200, 300].includes(totalLikes)) {
        mostrarEvento(`${ia} dio el like n√∫mero ${totalLikes} üéâ`);
      }
    }
    document.getElementById("likesContador").textContent = `Likes IA: ${totalLikes}`;
  }

  function mostrarEvento(texto) {
    const evento = document.getElementById("eventoEspecial");
    evento.textContent = texto;
    evento.style.display = "block";
    setTimeout(() => {
      evento.style.display = "none";
    }, 3000);
  }
</script>

</body>
</html>