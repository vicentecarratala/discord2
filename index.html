<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>üéÆ Directo IA con Pantalla Compartida</title>
  <style>
    body {
      margin: 0;
      background: #0d0d0d;
      color: #00ffcc;
      font-family: 'Orbitron', sans-serif;
      overflow: hidden;
    }
    #pantalla {
      position: relative;
      width: 100vw;
      height: 100vh;
      background-color: #111;
    }
    #stream {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      border: none;
    }
    #comentarios {
      position: absolute;
      top: 20px;
      left: 20px;
      width: 60%;
      max-height: 80%;
      overflow-y: auto;
      padding: 10px;
      background: rgba(0, 0, 0, 0.6);
      border-left: 4px solid #00ffcc;
      border-radius: 6px;
      z-index: 10;
    }
    .comentario {
      background: #222;
      margin: 5px 0;
      padding: 8px;
      border-radius: 4px;
      color: #fff;
    }
    .nombreIA {
      color: #ff00cc;
      font-weight: bold;
    }
    #controles {
      position: absolute;
      top: 20px;
      right: 20px;
      z-index: 20;
    }
    button {
      padding: 10px;
      margin: 5px;
      background-color: #222;
      border: 1px solid #00ffcc;
      color: #00ffcc;
      border-radius: 5px;
      font-size: 16px;
    }
    button:hover {
      background-color: #00ffcc;
      color: #000;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div id="pantalla">
  <video id="stream" autoplay muted></video>
  <div id="comentarios"></div>
  <div id="controles">
    <button onclick="compartirPantalla()">üñ•Ô∏è Compartir pantalla</button>
    <button onclick="activarEscucha()">üéôÔ∏è Escuchar IA</button>
    <button onclick="terminarDirecto()">üõë Terminar</button>
  </div>
</div>

<script>
  let recognition;
  const IAs = ["ShadowBot", "PixelQueen", "NeoJester", "EchoNova"];

  async function compartirPantalla() {
    try {
      const stream = await navigator.mediaDevices.getDisplayMedia({ video: true, audio: true });
      document.getElementById('stream').srcObject = stream;
    } catch (err) {
      alert("No se pudo compartir la pantalla: " + err.message);
    }
  }

  function activarEscucha() {
    if (!('webkitSpeechRecognition' in window)) {
      alert("Tu navegador no soporta reconocimiento de voz. Usa Chrome o Edge.");
      return;
    }

    recognition = new webkitSpeechRecognition();
    recognition.lang = "es-ES";
    recognition.continuous = true;
    recognition.interimResults = false;

    recognition.onresult = function(event) {
      for (let i = event.resultIndex; i < event.results.length; ++i) {
        if (event.results[i].isFinal) {
          const texto = event.results[i][0].transcript.trim();
          responderIA(texto);
        }
      }
    };

    recognition.onerror = function(event) {
      console.error("Error de reconocimiento:", event.error);
    };

    recognition.start();
    alert("IA escuchando... Habla mientras compartes pantalla para que comenten.");
  }

  function terminarDirecto() {
    // Detener reconocimiento de voz
    if (recognition && recognition.stop) {
      recognition.stop();
      recognition = null;
    }

    // Detener stream de pantalla
    const video = document.getElementById('stream');
    const tracks = video.srcObject?.getTracks();
    if (tracks) {
      tracks.forEach(track => track.stop());
    }

    // Limpiar el video
    video.srcObject = null;

    // Mensaje de cierre
    alert("üé¨ Directo finalizado. Gracias por compartir tu pantalla.");
  }

  function responderIA(texto) {
    IAs.forEach(nombre => {
      const respuesta = razonar(texto, nombre);
      mostrarComentario(nombre, respuesta);
    });
  }

  function razonar(texto, nombre) {
    texto = texto.toLowerCase();
    if (texto.includes("entrenamiento")) {
      return `${nombre}: Tienes raz√≥n, se nota que est√°s puliendo t√©cnica.`;
    }
    if (texto.includes("dif√≠cil") || texto.includes("complicado")) {
      return `${nombre}: S√≠, ese momento fue un reto. Lo manejaste bien.`;
    }
    if (texto.includes("victoria") || texto.includes("gan√©")) {
      return `${nombre}: ¬°Felicidades! Esa victoria fue merecida.`;
    }
    if (texto.includes("fallo") || texto.includes("error")) {
      return `${nombre}: Todos fallamos a veces. Lo importante es aprender.`;
    }

    const inicio = ["Interesante lo que dijiste sobre", "Buen punto sobre", "Me gust√≥ cuando hablaste de"];
    const cierre = ["¬°Sigue as√≠!", "Eso me hizo pensar.", "Muy bien expresado."];
    const fragmento = texto.split(" ").slice(0, 6).join(" ") + "...";
    return `${nombre}: ${inicio[Math.floor(Math.random() * inicio.length)]} "${fragmento}". ${cierre[Math.floor(Math.random() * cierre.length)]}`;
  }

  function mostrarComentario(nombre, texto) {
    const div = document.createElement('div');
    div.className = 'comentario';
    div.innerHTML = `<span class="nombreIA">${nombre}:</span> ${texto}`;
    document.getElementById('comentarios').appendChild(div);
  }
</script>

</body>
</html>